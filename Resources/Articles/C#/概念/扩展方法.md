# C# æ‰©å±•æ–¹æ³•å…¨é¢è§£æ

## ä¸€ã€æ‰©å±•æ–¹æ³•åŸºç¡€æ¦‚å¿µ

#### ä»€ä¹ˆæ˜¯æ‰©å±•æ–¹æ³•
- **å®šä¹‰**ï¼šå‘ç°æœ‰ç±»å‹æ·»åŠ æ–°æ–¹æ³•ï¼Œæ— éœ€ä¿®æ”¹åŸç±»å‹

####  å£°æ˜è¯­æ³•
é™æ€æ–¹æ³•+å…³é”®å­—`this`
```csharp
// é™æ€ç±»å‘½åè§„èŒƒï¼šè¢«æ‰©å±•ç±»å + Extensions
public static class UserExtensions
{
    // é™æ€æ–¹æ³• + thiså…³é”®å­—
    public static bool IsValid(this User user)
    {
        return !string.IsNullOrEmpty(user.Name) && user.IsActive;
    }
}
```

## äºŒã€æ ¸å¿ƒç‰¹æ€§ä¸ç”¨æ³•

#### åŸºæœ¬ä½¿ç”¨
```csharp
// ä¼ ç»Ÿè°ƒç”¨æ–¹å¼
UserExtensions.IsValid(user);

// æ‰©å±•æ–¹æ³•è°ƒç”¨æ–¹å¼ï¼ˆæ¨èï¼‰
user.IsValid();
```

#### ç¼–è¯‘å™¨æ ‡è¯†
- æ‰©å±•æ–¹æ³•åœ¨IDEä¸­æ˜¾ç¤º**å°ç®­å¤´å›¾æ ‡**
- Visual Studio/Riderä¸­æ ‡æ³¨"ï¼ˆæ‰©å±•ï¼‰"

#### ä¸ºåŸºæœ¬ç±»å‹æ‰©å±•
```csharp
public static class IntExtensions
{
    public static bool IsEven(this int value) => value % 2 == 0;
    public static int Square(this int value) => value * value;
}

// ä½¿ç”¨
int value = 10;
value.IsEven();    // true
value.Square();    // 100
```

## ä¸‰ã€é‡è¦æ³¨æ„äº‹é¡¹

### 3.1 å‘½åå†²çªè§„åˆ™
- æ‰©å±•æ–¹æ³•ä¸ç±»æˆå‘˜æ–¹æ³•åŒåæ—¶ï¼Œ**ä¼˜å…ˆè°ƒç”¨ç±»æˆå‘˜æ–¹æ³•**
- å¼ºåˆ¶è°ƒç”¨æ‰©å±•æ–¹æ³•ï¼šé€šè¿‡é™æ€ç±»ç›´æ¥è°ƒç”¨
```csharp
user.Intro();                    // è°ƒç”¨ç±»æˆå‘˜æ–¹æ³•
UserExtensions.Intro(user);     // è°ƒç”¨æ‰©å±•æ–¹æ³•
```

### 3.2 åå°„è°ƒç”¨
```csharp
// é”™è¯¯æ–¹å¼ï¼šåœ¨ç›®æ ‡ç±»ä¸ŠæŸ¥æ‰¾
typeof(User).GetMethod("Intro", BindingFlags.Instance | BindingFlags.Public);

// æ­£ç¡®æ–¹å¼ï¼šåœ¨é™æ€æ‰©å±•ç±»ä¸ŠæŸ¥æ‰¾
typeof(UserExtensions).GetMethod("Intro", BindingFlags.Static | BindingFlags.Public);
method.Invoke(null, new object[] { user });  // ç¬¬ä¸€ä¸ªå‚æ•°ä¼ null
```

### 3.3 è®¿é—®æƒé™é™åˆ¶
- æ‰©å±•æ–¹æ³•**æ— æ³•è®¿é—®**ç±»çš„ç§æœ‰æˆå‘˜
- ä½äºç±»å¤–éƒ¨ï¼Œå—C#è®¿é—®ä¿®é¥°ç¬¦é™åˆ¶

## å››ã€é«˜çº§åº”ç”¨åœºæ™¯

### 4.1 é¸­å­ç±»å‹å®ç°
```csharp
// é€šè¿‡æ‰©å±•æ–¹æ³•è®©è‡ªå®šä¹‰ç±»å‹æ”¯æŒawait
public static class MyDelayExtensions
{
    public static TaskAwaiter GetAwaiter(this MyDelay delay)
    {
        return Task.Delay(1000).GetAwaiter();
    }
}

// ç”šè‡³ä¸ºåŸºç¡€ç±»å‹æ·»åŠ awaitæ”¯æŒ
public static class TimeSpanExtensions
{
    public static TaskAwaiter GetAwaiter(this TimeSpan timeSpan)
    {
        return Task.Delay(timeSpan).GetAwaiter();
    }
}
```

### 4.2 é›†åˆè¡¨è¾¾å¼æ”¯æŒ
```csharp
public static class MyCollectionExtensions
{
    public static void Add<T>(this MyCollection<T> collection, T item)
    {
        collection.Push(item);  // è°ƒç”¨å†…éƒ¨æ–¹æ³•
    }
}
// ä½¿å¾—è‡ªå®šä¹‰é›†åˆæ”¯æŒæ–°çš„åˆå§‹åŒ–è¯­æ³•ï¼šMyCollection<int> col = [1, 2, 3];
```

### 4.3 æœåŠ¡æ³¨å†Œæ¨¡å¼ï¼ˆASP.NET Coreé£æ ¼ï¼‰
```csharp
public static class ServiceCollectionExtensions
{
    public static IServiceCollection AddCustomServices(this IServiceCollection services)
    {
        services.AddSingleton<IMyLog, MyLog>();
        services.AddTransient<IMyCustomService, MyCustomService>();
        return services;  // æ”¯æŒé“¾å¼è°ƒç”¨
    }
}

// ä½¿ç”¨
services.AddCustomServices()
        .AddOtherServices();
```

## äº”ã€å°è£…æœ€ä½³å®è·µ

### 5.1 å‘½åç©ºé—´éš”ç¦»
```csharp
namespace MyCompany.Extensions
{
    public static class StringExtensions
    {
        public static string Reverse(this string str) => new string(str.Reverse().ToArray());
    }
}

// æŒ‰éœ€å¼•å…¥ï¼šusing MyCompany.Extensions;
```

### 5.2 é¿å…ç±»å‹æ±¡æŸ“
- ä¸è¦å°†æ‰©å±•æ–¹æ³•æ”¾åœ¨å¸¸ç”¨å‘½åç©ºé—´ï¼ˆå¦‚Systemï¼‰
- æ ¹æ®ä½¿ç”¨åœºæ™¯åˆç†ç»„ç»‡å‘½åç©ºé—´ç»“æ„
- å‚è€ƒLINQçš„è®¾è®¡ï¼šé»˜è®¤ä¸å¼•å…¥ï¼Œéœ€è¦æ—¶using System.Linq

## å…­ã€C# 14æ–°ç‰¹æ€§ï¼šæ‰©å±•æˆå‘˜

### 6.1 æ–°è¯­æ³•æ ¼å¼
```csharp
public static class StringExtensions
{
    // æ‰©å±•å±æ€§ï¼ˆæ–°è¯­æ³•ï¼‰
    extension string Source
    {
        public bool HasContent => !string.IsNullOrEmpty(Source);
    }
    
    // æ‰©å±•é™æ€æ–¹æ³•ï¼ˆæ–°è¯­æ³•ï¼‰
    extension string
    {
        public static int WordCount(string sentence) => sentence.Split(' ').Length;
    }
}
```

### 6.2 ä¼˜åŠ¿å¯¹æ¯”
| ç‰¹æ€§ | ä¼ ç»Ÿæ‰©å±•æ–¹æ³• | æ–°æ‰©å±•æˆå‘˜ |
|------|-------------|------------|
| å®ä¾‹æ–¹æ³• | âœ… | âœ… |
| å±æ€§æ”¯æŒ | âŒ | âœ… |
| é™æ€æ–¹æ³• | âŒ | âœ… |
| è¯­æ³•ç®€æ´æ€§ | ä¸€èˆ¬ | æ›´å¥½ |

### 6.3 åº•å±‚å®ç°
- ä»ç„¶æ˜¯**è¯­æ³•ç³–**ï¼Œç¼–è¯‘ä¸ºé™æ€ç±»æ–¹æ³•
- å®ä¾‹æˆå‘˜ç¼–è¯‘ä¸ºï¼š`StringExtensions.GetHasContent(s1)`
- é™æ€æˆå‘˜ç¼–è¯‘ä¸ºï¼š`StringExtensions.WordCount(s1)`

## ä¸ƒã€é€‚ç”¨åœºæ™¯æ€»ç»“

1. **ç¬¬ä¸‰æ–¹åº“ç±»å‹æ‰©å±•**ï¼šæ— æ³•ä¿®æ”¹æºç çš„DTOã€Entityç±»
2. **åŸºç¡€ç±»å‹å¢å¼º**ï¼šintã€stringç­‰ç³»ç»Ÿç±»å‹çš„å·¥å…·æ–¹æ³•
3. **æ¶æ„å°è£…**ï¼šä¾èµ–æ³¨å…¥æ³¨å†Œã€æœåŠ¡é…ç½®
4. **è¯­æ³•ç³–å®ç°**ï¼šè®©è‡ªå®šä¹‰ç±»å‹æ”¯æŒæ–°è¯­æ³•ç‰¹æ€§
5. **ä»£ç ç»„ç»‡**ï¼šå°†ç›¸å…³åŠŸèƒ½é€»è¾‘åˆ†ç»„å°è£…

## å…«ã€æ ¸å¿ƒè¦ç‚¹å›é¡¾

- ğŸ¯ **æœ¬è´¨**ï¼šé™æ€ç±»çš„é™æ€æ–¹æ³•ï¼Œé€šè¿‡thiså…³é”®å­—æä¾›è¯­æ³•ç³–
- ğŸ”§ **åå°„**ï¼šéœ€è¦åœ¨é™æ€æ‰©å±•ç±»ä¸Šæ“ä½œï¼Œè€Œéç›®æ ‡ç±»
- ğŸš« **é™åˆ¶**ï¼šæ— æ³•è®¿é—®ç§æœ‰æˆå‘˜ï¼Œä¼˜å…ˆçº§ä½äºç±»åŸç”Ÿæ–¹æ³•
- ğŸ“¦ **å°è£…**ï¼šé€šè¿‡å‘½åç©ºé—´æ§åˆ¶å¯è§æ€§ï¼Œé¿å…æ±¡æŸ“
- ğŸ†• **å‘å±•**ï¼šC# 14å¼•å…¥æ‰©å±•æˆå‘˜ï¼Œæ”¯æŒå±æ€§å’Œé™æ€æ–¹æ³•æ‰©å±•

é€šè¿‡åˆç†ä½¿ç”¨æ‰©å±•æ–¹æ³•ï¼Œå¯ä»¥æ˜¾è‘—æå‡ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ï¼ŒåŒæ—¶ä¿æŒå¯¹ç°æœ‰ä»£ç çš„é›¶ä¾µå…¥æ€§ã€‚