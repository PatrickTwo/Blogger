在C#中，**匿名函数**是一种没有显式名称的函数，它可以直接在代码中定义并使用。匿名函数通常用于简化代码，尤其是在需要传递函数作为参数（例如委托或 Lambda 表达式）的场景中。

C# 支持两种匿名函数：
1. **匿名方法**（Anonymous Methods）
2. **Lambda 表达式**（Lambda Expressions）

---

## 1. 匿名方法（Anonymous Methods）
匿名方法是 C# 2.0 引入的特性，允许在不定义单独方法的情况下直接编写代码块。

### 语法
```csharp
delegate (参数列表)
{
    // 方法体
};
```

### 示例
```csharp
using System;

class Program
{
    delegate void MyDelegate(string message);

    static void Main()
    {
        // 使用匿名方法
        MyDelegate myDelegate = delegate (string msg)
        {
            Console.WriteLine("Message: " + msg);
        };

        // 调用匿名方法
        myDelegate("Hello from anonymous method!");
    }
}
```

### 输出
```
Message: Hello from anonymous method!
```

### 特点
- 使用 `delegate` 关键字定义。
- 可以访问外部变量（闭包）。
- 通常用于早期版本的 C#，现在更推荐使用 Lambda 表达式。

---

## 2. Lambda 表达式（Lambda Expressions）
Lambda 表达式是 C# 3.0 引入的特性，提供了一种更简洁的方式来定义匿名函数。它是匿名方法的进一步简化。

### 语法
```csharp
(参数列表) => 表达式或代码块
```

- 如果只有一个参数，可以省略括号。
- 如果方法体只有一条语句，可以省略大括号和 `return` 关键字。

### 示例
#### 示例 1：简单的 Lambda 表达式
```csharp
using System;

class Program
{
    delegate int MyDelegate(int x, int y);

    static void Main()
    {
        // 使用 Lambda 表达式
        MyDelegate add = (x, y) => x + y;

        // 调用 Lambda 表达式
        int result = add(3, 5);
        Console.WriteLine("Result: " + result);
    }
}
```

#### 输出
```
Result: 8
```

#### 示例 2：Lambda 表达式与集合操作
```csharp
using System;
using System.Collections.Generic;
using System.Linq;

class Program
{
    static void Main()
    {
        List<int> numbers = new List<int> { 1, 2, 3, 4, 5 };

        // 使用 Lambda 表达式过滤偶数
        var evenNumbers = numbers.Where(n => n % 2 == 0);

        Console.WriteLine("Even numbers:");
        foreach (var num in evenNumbers)
        {
            Console.WriteLine(num);
        }
    }
}
```

#### 输出
```
Even numbers:
2
4
```

### 特点
- 语法简洁，易于阅读。
- 支持表达式体和语句体。
- 可以捕获外部变量（闭包）。
- 广泛应用于 LINQ 查询、事件处理和异步编程。

---

## 匿名函数与闭包
匿名函数（包括匿名方法和 Lambda 表达式）可以访问其外部作用域中的变量，这种行为称为**闭包**。

### 示例：闭包
```csharp
using System;

class Program
{
    static void Main()
    {
        int factor = 2;

        // Lambda 表达式捕获外部变量 factor
        Func<int, int> multiplier = x => x * factor;

        Console.WriteLine(multiplier(5)); // 输出 10

        factor = 3; // 修改外部变量
        Console.WriteLine(multiplier(5)); // 输出 15
    }
}
```

### 输出
```
10
15
```

### 说明
- Lambda 表达式 `x => x * factor` 捕获了外部变量 `factor`。
- 即使 `factor` 的值在后续被修改，Lambda 表达式仍然会使用最新的值。

---

## 匿名函数的使用场景
1. **事件处理**：为事件直接绑定匿名函数。
   ```csharp
   button.Click += (sender, e) => Console.WriteLine("Button clicked!");
   ```

2. **LINQ 查询**：在 LINQ 中使用 Lambda 表达式进行数据筛选和转换。
   ```csharp
   var result = list.Where(x => x > 10).Select(x => x * 2);
   ```

3. **委托和回调**：将匿名函数作为参数传递给方法。
   ```csharp
   Task.Run(() => Console.WriteLine("Running in a task!"));
   ```

4. **简化代码**：避免定义单独的方法，直接在代码中实现逻辑。

---

## 总结
| 特性                | 匿名方法                          | Lambda 表达式                     |
|---------------------|-----------------------------------|-----------------------------------|
| 语法                | 使用 `delegate` 关键字            | 使用 `=>` 运算符                  |
| 简洁性              | 较冗长                            | 更简洁                            |
| 适用场景            | C# 2.0，早期代码                  | C# 3.0 及以上，现代代码           |
| 闭包支持            | 支持                              | 支持                              |
| 推荐使用            | 不推荐，除非兼容旧代码            | 推荐                              |

在现代 C# 开发中，**Lambda 表达式**是匿名函数的首选方式，因为它更简洁、易读且功能强大。