## 一. 区分消息类型
:::info
发送自定义类序列化后的二进制数据时，由于接收方接收方接收的只是一个字节数组，无法直接区分其对应的具体消息类型，无法确定使用哪个类反序列化。
:::

#### **解决方案：添加消息ID区分消息**  
在数据字节数组的**头部添加消息ID**（类型可选`int`/`short`/`byte`/`long`，根据消息类型数量选择）。规则如下：  
- **消息构成**：前N字节为消息ID（如`int`占4字节），后续字节为具体数据类内容。  
- **接收逻辑**：收到字节数组后，先解析前N字节得到消息ID，再根据ID选择对应的自定义类反序列化。  

**示例**：定义ID=1对应`PlayerMessage`，ID=2对应`ChatMessage`，接收方解析ID后即可匹配正确的类。

---

## 二. 分包与黏包
:::info
在TCP通信中，由于网络传输的不确定性，可能会出现**分包**（数据被分成多个包发送）或**黏包**（多个包被合并成一个包接收）情况。
:::

- **分包**：发送方将数据切分成多个包发送，接收方需要处理合并。
- **黏包**：接收方将多个包合并成一个包接收，发送方需要处理拆分。
:::hint
分包和黏包可能同时发生
:::


#### **解决方案：添加一个消息长度字段放入消息头部**

---

## 二. 心跳消息

心跳消息（Heartbeat）用于在客户端与服务端之间定期发送轻量级数据包，以确认连接仍然活跃、检测断线，确保长链接的有效性。

1. 服务端通过心跳消息进行超时判断，如果超时没有收到客户端消息，视为客户端已经断开连接。
2. 避免客户端长时间不发送消息，导致防火墙或路由器断开连接