### 装饰器模式学习笔记


#### **一、核心定义**  
装饰器模式：允许将对象放入包含行为的特殊封装对象中，为原对象动态绑定新行为。**核心目标**：不改变原始对象结构的前提下，动态添加额外功能。


#### **二、游戏开发典型应用：角色Buff系统**  
场景：释放增益技能/获得道具时，动态改变角色攻击力、防御力、移动速度等属性，需优雅组织代码结构。


#### **三、代码示例结构（以游戏角色为例）**  
##### 1. **组件（Component）：统一接口**  
- 定义：`Character`接口，约定所有角色需实现的核心方法（如`attack()`）。  

##### 2. **具体组件（Concrete Component）：基础功能实现**  
- 定义：`BasicCharacter`类，实现`Character`接口，重写`attack()`方法，输出“basic attack”（代表无加成的基础攻击）。  

##### 3. **装饰器基类（Decorator Base Class）：关键桥梁**  
- 特点：  
  - 继承`Character`接口，实现`attack()`方法（使装饰器可视为“角色”，能执行必要攻击逻辑）；  
  - 初始化时持有**原始角色实例**（通过成员变量保存），可调用原始角色的攻击逻辑。  

##### 4. **具体装饰器（Concrete Decorator）：附加功能实现**  
- 示例：`AttackBoostDecorator`（攻击力提升装饰器）：  
  - 构造时传入“提升的攻击力数值”作为私有字段；  
  - 重写`attack()`：先执行增益逻辑（如输出“攻击力提升X”），再调用原始角色的`attack()`方法。  

##### 5. **客户端使用**  
- 将`BasicCharacter`实例传入装饰器，构造“增强后角色”；调用其`attack()`时，执行“装饰器增益逻辑+原始攻击逻辑”。  


#### **四、装饰器模式四大关键要素**  
| 要素                                 | 作用                                                               |
| ------------------------------------ | ------------------------------------------------------------------ |
| **组件（Component）**                | 定义统一接口（如`Character`），所有装饰器和具体组件需实现该接口。  |
| **具体组件（Concrete Component）**   | 实现最基础功能（如`BasicCharacter`，完成无增益的基础攻击）。       |
| **装饰器基类（Decorator）**          | ① 实现组件接口；② 持有组件对象，可调用原始组件逻辑。               |
| **具体装饰器（Concrete Decorator）** | 继承装饰器基类，重写接口方法，插入自身增益逻辑后调用基础组件逻辑。 |


#### **五、其他经典应用场景**  
1. **协作系统用户权限控制**：普通用户、管理员、超级管理员等角色权限动态变化（查看/发布/删除内容权限不同），通过装饰器动态赋予权限。  
2. **游戏输入系统**：对遥感、鼠标的抖动过滤，窗口大小变化后鼠标坐标与游戏世界坐标的重新映射（坐标转换功能）。  
3. **网络数据传输**：原始数据加密、压缩、添加协议头等步骤，通过装饰器链式处理。  


#### **六、优缺点分析**  
##### **优点**  
- **无需创建新子类即可扩展行为**：避免继承导致的类爆炸，功能扩展更灵活。  
- **运行时动态增删功能**：不依赖静态继承关系，可按需添加/移除装饰器。  
- **符合单一职责原则**：每个装饰器仅负责一种功能（如攻击提升、防御提升），可通过组合实现复杂逻辑（“无限细分装饰器”）。  

##### **缺点**  
- **移除特定装饰器较麻烦**：若需动态移除某装饰器，需额外追踪字段记录装饰器链。  
- **装饰器效果需独立且无依赖**：增益效果不能因添加顺序影响结果（对数值计算逻辑要求高，如Buff叠加需保证顺序无关性）。  


#### **七、总结**  
装饰器模式通过“组件接口+装饰器持有原始对象+链式调用”的方式，实现了对象功能的动态扩展，尤其适用于需灵活增减功能的场景（如游戏Buff、权限控制、数据处理）。核心价值：**动态性、低耦合、功能组合灵活**。