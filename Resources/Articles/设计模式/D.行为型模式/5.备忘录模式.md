**笔记：备忘录模式（Memento Pattern）**  

- **定义**  
  允许在不暴露对象实现细节的情况下，保存和恢复对象之前的状态。常用于游戏存档、软件备份、创建回溯点等场景。  

- **核心思想**  
  将对象的关键状态抽取到独立的**备忘录（Memento）**中，通过备忘录实现状态的保存与恢复，且不破坏原对象的封装性。  

- **示例场景：游戏角色存档与恢复**  
  1. **游戏角色类（Originator）**  
     - 拥有角色状态字段（设为私有）。  
     - 提供 `SaveState()`：生成并返回一个备忘录对象（拷贝必要状态）。  
     - 提供 `RestoreState(Memento m)`：从备忘录中读取状态并恢复到自身。  
  2. **备忘录类（Memento）**  
     - 嵌套在角色类内或独立定义，作为状态容器。  
     - 拷贝角色需要保存的必要状态字段（不包含无需存档的临时数据）。  
     - 对外仅提供有限访问接口（或由负责人管理），保证封装性。  
  3. **负责人（Caretaker）**  
     - 管理备忘录的历史记录（如用 `vector<Memento>` 实现堆栈或列表）。  
     - 提供保存备忘录（`AddMemento(m)`）与获取备忘录（`GetMemento(index)`）的方法。  
     - 客户端通过负责人存取备忘录，避免直接接触角色内部状态。  
  4. **客户端流程**  
     - 创建角色 → 调用 `SaveState()` 生成备忘录 → 交由负责人保存。  
     - 修改角色状态 → 调用负责人的 `GetMemento()` 取回之前备忘录 → 调用角色 `RestoreState()` 恢复。  

- **构成要素**  
  1. **原发器（Originator）**：需要保存/恢复状态的对象。  
  2. **备忘录（Memento）**：存储原发器内部状态的快照。  
  3. **负责人（Caretaker）**：管理备忘录的存储与提供，不操作备忘录内容。  

- **优点**  
  - 不破坏对象封装性，无需为存档功能暴露所有字段的 getter。  
  - 备忘录类职责单一，仅负责数据存储，与业务逻辑分离。  
  - 可灵活选择保存的状态字段（有选择拷贝），避免冗余数据。  

- **与其他模式的关系**  
  1. **与原型模式**  
     - 原型模式是全量拷贝对象，可视为备忘录模式的“退化”形式。  
     - 备忘录模式可有选择地保存部分状态，适用于只需存档关键数据的场景。  
  2. **与命令模式**  
     - 命令模式记录**行为**（操作），撤销/重做通过执行或反向执行命令实现（增量修改）。  
     - 备忘录模式记录**数据状态快照**，恢复时一次性还原对象特征。  
     - 二者可结合使用：命令模式管理操作序列，备忘录模式保存关键状态点。  

- **实践提示**  
  设计模式是经验总结而非死板教条，应理解核心理念并在项目中灵活组合运用，不必拘泥于严格定义。